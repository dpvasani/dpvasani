name: Achievements 
on:
  # Schedule updates (At minute 0 past every 12th hour)
  schedule: [{ cron: "0 */12 * * *" }]
  # Allow manual triggering and triggering on push to specific branches
  workflow_dispatch:
  push: { branches: ["master", "main", "metrics"] }

jobs:
  achievement-metrics:
    runs-on: ubuntu-latest

    steps:
      # Cache NPM dependencies for faster builds
      - name: Cache NPM dependencies
        uses: actions/cache@v3
        with:
          path: ~/.npm
          key: ${{ runner.os }}-npm-cache
          restore-keys: |
            ${{ runner.os }}-npm-cache

      # Setup Node.js
      - uses: actions/setup-node@v2
        with:
          node-version: '14'

      # Install dependencies (if needed for other plugins)
      - run: npm install

      # Run Metrics to generate the achievement badge
      - uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          user: dpvasani
          template: classic
          base: ""
          config_timezone: Asia/Calcutta
          plugin_achievements: yes
          plugin_achievements_display: compact
          plugin_achievements_secrets: yes
          plugin_achievements_threshold: C

      # Optionally commit the generated file to the repo
      - name: Commit and Push
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add assets/metrics.plugin.achievements.svg
          git commit -m "Update metrics"
          git push

