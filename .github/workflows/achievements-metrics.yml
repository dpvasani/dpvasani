name: Achievements 
on:
  schedule: [{ cron: "0 */12 * * *" }]
  workflow_dispatch:
  push: { branches: ["master", "main", "metrics"] }

jobs:
  achievement-metrics:
    runs-on: ubuntu-latest
    steps:
      # Checkout the repository
      - name: Checkout repository
        uses: actions/checkout@v3
      
      # Cache NPM dependencies for faster builds (optional)
      - name: Cache NPM dependencies
        uses: actions/cache@v3
        with:
          path: ~/.npm
          key: ${{ runner.os }}-npm-cache
          restore-keys: |
            ${{ runner.os }}-npm-cache

      # Setup Node.js
      - uses: actions/setup-node@v2
        with:
          node-version: '14'

      # Install dependencies (if needed for other plugins)
      - run: npm install

      # Run Metrics to generate the achievement badge
      - uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          user: dpvasani
          template: classic
          base: ""
          config_timezone: Asia/Calcutta
          plugin_achievements: yes
          plugin_achievements_display: compact
          plugin_achievements_secrets: yes
          plugin_achievements_threshold: C

      # Commit and Push the generated metrics SVG
      - name: Commit and Push All Changes
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add .
          git commit -m "Update metrics and other changes"
          git push

